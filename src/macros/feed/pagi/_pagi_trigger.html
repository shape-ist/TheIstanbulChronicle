{% macro pagi_trigger() %}
<div id="pagi-trigger"></div>

<style>
    #pagi-trigger {
        position: relative;
        background: transparent;
        opacity: 0;
        height: 1px;
        width: 100%;
        top: calc(100% - 800px);
        pointer-events: none !important;
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
    integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
    crossorigin="anonymous"></script>
<script type="text/javascript" charset="utf-8">
    var pagiState = false

    function inArea(threshold = 100, current = $(window).scrollTop()) {
        return current + $(window).height() > $(document).height() - threshold
    }

    function canPagi() {
        return ($('#pagi-trigger').visible() && !pagiState)
    }

    var socket = io();
    var uidFlags = [null]

    $(document).ready(function(){
        socket.on('message', function(msg){
            console.log(msg)
            uidFlags.push(msg.last_uid)
            pagiState = false
        })
    });

    var intervalId = window.setInterval(function(){
        if (canPagi()){
            pagiState = true
            if (uidFlags.at(-1) !== undefined){
                socket.emit('pagiRequest', uidFlags.at(-1));
            }
            $('#article-list').height("+=1000");
            
        }
    }, 500);

</script>
{% endmacro %}